% !TEX option = -shell-escape
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% This work is licensed under the Creative Commons Attribution 4.0
% International License. To view a copy of this license, visit
% http://creativecommons.org/licenses/by/4.0/.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[12pt]{ussci}

\usepackage{todonotes}

\newcommand\ck{ChemKED}
\newcommand\pk{PyKED}

\usepackage[inline]{enumitem}
\setlist{noitemsep}

\usepackage{microtype}
%======================================================================
\addbibresource{pyked.bib}
%======================================================================
\newcommand\papertopic{Reaction Kinetics}
%======================================================================

\title{ ChemKED: a human- and machine-readable data standard for chemical kinetics experiments }

\author[1*]{Bryan W. Weber}
\author[2]{Kyle E. Niemeyer}

\affil[1]{Department of Mechanical Engineering, University of Connecticut, Storrs, CT, USA}
\affil[2]{School of Mechanical, Industrial, and Manufacturing Engineering, Oregon State University, Corvallis, OR, USA}
\affil[*]{Corresponding author: \email{bryan.weber@uconn.edu}}

\begin{document}
\maketitle

%====================================================================
\begin{abstract} % not to exceed 200 words
Fundamental experimental measurements of quantities including ignition delay
times, laminar flame speeds, and species profiles serve important roles in
understanding fuel chemistry and validating chemical kinetic models. However,
despite both the importance and abundance of such information in the literature,
the community lacks a widely adopted standard format for this data. This impedes
both sharing and wide use by the community. In this talk, we will introduce a
new Chemical Kinetics Experimental Data format, ChemKED, and the related
Python-based package for creating and validating ChemKED-formatted files called
PyKED. We will also review past and related efforts, and motivate the need for a
new solution. ChemKED currently supports the representation of autoignition
delay time and laminar flame speed measurements. ChemKED-formatted files contain
all of the information needed to simulate experimental data points, including
uncertainty. ChemKED is based on the YAML data serialization language, and is
intended as a human- and machine-readable standard for easy creation and
automated use. Development of ChemKED and PyKED occurs openly on GitHub under
the BSD 3-clause license, and contributions from the community are welcome.
Plans for future development include support for experimental data from jet
stirred reactor, extinction, and speciation measurements.
\end{abstract}

% (Provide 2-4 keywords describing your research. Only abbreviations firmly
% established in the field may be used. These keywords will be used for
% sessioning/indexing purposes.)
\begin{keyword}
    chemical kinetics\sep software\sep database
\end{keyword}

%====================================================================
\section{Introduction}
%
\todo[inline]{Kyle to do}

Fundamental combustion experiments provide

%====================================================================
\section{Related work}
%
\todo[inline]{Kyle to do}

The combustion\slash chemical kinetics community lacks an accepted, commonly used
standard for recording and sharing data from fundamental combustion experiments.
Interestingly, this contrasts the situation for chemical kinetic models, where the
CHEMKIN~\autocite{Kee:1996ck} format dominates. Competing standards such as the
Cantera~\autocite{Cantera:2.3.0} CTI format or FlameMaster lag behind considerably, although
use of the former continually grows due to Cantera's open availability.\todo{add flamemaster citation}{}
Similarly,

Instead, such data must typically be found in under-documented, nonstandard comma-separated value
files and Excel spreadsheets, or even contained in PDF tables or figures rather than as
supplementary material associated with a paper.

While the community has not widely adopted a standard format,
---most notably, Frenklach developed the PrIMe (\textbf{Pr}ocess \textbf{I}nformatics
\textbf{M}od\textbf{e}l) data format~\autocite{Frenklach:2007bm,You:2011hy} and an associated
online database, the PrIMe Data Warehouse~\autocite{PrIMe}.

More recently, Varga et al.~\autocite{Varga2015a,Varga2015b} developed the \texttt{ReSpecTh} standard,
an XML-based format that builds on, and is compatible with, PrIMe.

We aim to develop a new, human- and machine-readable data standard for fundamental combustion
experiments, \ck{}, and offer tools for easily working with data encoded in this format.
Our motivations are similar to some of those of the PrIMe and \texttt{ReSpecTh} teams, although
less ambitious in scope: enable easy sharing and use of data, for the (primary) purposes of
developing and validating predictive chemical kinetic models.
However, those efforts were generally less successful in being adopted---we hope to succeed
by developing more user-friendly data files and tools for interacting with them.

Niemeyer recently introduced an initial version of the \ck{} format~\autocite{Niemeyer:2016wf},
and in this work we further formalize and develop the standard. We also discuss a related
Python software tool for validating and working with \ck{} files: \pk{}.

%====================================================================
\section{Overview of format}\label{sec:overview-of-format}

The \ck{} file is a YAML-format file. This format offers the advantages of being
human readable, written in plain text, and having parsers in most common
programming languages, including Python, C++, Java, Perl, MATLAB, and many
others. The YAML syntax is quite simple. The basic file structure is made of
mappings, delimited by a colon. The key for the mapping is on the left of the
colon, and the value on the right can be a single value, a sequence of values,
a nested mapping, or some combination of these:

\begin{minted}{yaml}
    key1: value  # Single-value mapping
    key2: [0, 1, 2]  # Mapping with sequence
    key3:  # Alternative sequence format
      - value
      - value
    key4:  # Nested mapping
      key5: 0
\end{minted}

The \yaml|value| can be a string, integer, or floating point number. The type is
inferred from the \yaml|key| when the value is read. The \ck{} format is
designed to include all of the information necessary to simulate a given
experiment and can be broken into two main sections. The first section details
all of the ``meta'' information about the experiment and the \ck{} file. In this
section, the common \yaml|author| mapping is used for any fields where an author
must be specified. The \yaml|author| mapping contains the following fields:
%
\begin{itemize}
    \item \yaml|name| (required, string): The author's full name
    \item \yaml|ORCID| (optional, string): the author's ORCID number
\end{itemize}
%
More generally for the meta information, the required keys in this section
are:
%
\begin{itemize}
    \item \yaml|file-author| (required, \yaml|author|-type mapping): The author
    of the \ck{} file
    \item \yaml|file-version| (required, integer): The version of the \ck{} file
    \item \yaml|chemked-version| (required, string): The version of the \ck{}
    schema that this file conforms to
    \item \yaml|reference| (required, mapping): The reference information for
    the article associated with the data in the file. The fields in this
    mapping are:
    \begin{itemize}
        \item \yaml|authors| (required, sequence): A sequence of \yaml|author|
        mappings
        \item \yaml|journal| (required, string): The name of the publishing
        journal
        \item \yaml|year| (required, integer): The year of publication
    \end{itemize}
    \item \yaml|experiment-type| (required, string): One of \yaml|ignition
    delay| or \yaml|flame speed|
    \item \yaml|apparatus| (required, string): The type of apparatus used to
    perform the experiment
\end{itemize}

In addition to the meta information, the data encoded in the \ck{} file is in
a mapping called \yaml|datapoints|. The \yaml|datapoints| mapping contains a
sequence of nested mappings, with the following information for each element of
the sequence:
%
\begin{itemize}
    \item \yaml|temperature| (required, sequence): The temperature of the
    experiment, with units
    \item \yaml|ignition-delay| (optional, sequence): The ignition delay of the
    experiment, with units, if the \yaml|experiment-type| is \yaml|ignition
    delay|
    \item \yaml|flame-speed| (optional, sequence): The flame speed of the
    experiment, with units, if the \yaml|experiment-type| is \yaml|flame speed|
    \item \yaml|pressure| (required, string): The pressure of the experiment,
    with units
    \item \yaml|composition| (required, sequence): The composition of the
    mixture in the experiment, a sequence of mappings with the following fields
    \begin{itemize}
        \item \yaml|species-name| (required, string): The name of the species
        \item \yaml|mole-fraction|, \yaml|mass-fraction|, \yaml|mole-percent|
        (required, float): The mole fraction or percent, or the mass fraction.
        Only one of the three is permitted in a given \yaml|composition|
        sequence.
        \item \yaml|InChI|, \yaml|SMILES|, \yaml|atomic-composition|, or
        \yaml|elemental-composition| (required, string or sequence): The InChI
        or SMILES representing the molecule, or its atomic or elemental
        composition (\yaml|atomic-composition| and \yaml|elemental-composition|
        are synonyms) as a sequence
    \end{itemize}
    \item \yaml|ignition-type| (required, mapping); The type of ignition
    measured in the experiments. The required fields are
    \begin{itemize}
        \item \yaml|type| (required, string): How the ignition delay was
        measured, one of \yaml|d/dt max| to indicate the ignition point is
        found at the maximum of the time derivative of the \yaml|target|, or
        \yaml|max| or \yaml|min| to indicate the ignition point is at the
        maximum or minimum of the \yaml|target|
        \item \yaml|target| (required, string): The target for the type of the
        ignition point, one of \yaml|temperature|, \yaml|pressure|, \yaml|OH|,
        \yaml|OH*|, \yaml|CH|, or \yaml|CH*|
    \end{itemize}
\end{itemize}

Each of the quantities in a datapoint must be specified with units. This should
be done as a single string associated with the first element of the sequence.
The units of the quantity are validated to ensure they have the appropriate
dimensionality for the quanity. In addition, each of the quantities in the
\yaml|datapoint| can optionally be assigned an uncertainty. This uncertainty can
be either absolute or relative, and is specified as elements of the sequence of
the associated key. For example, the absolute uncertainty of the temperature and
the relative uncertainty of the ignition delay might be specified as follows:

\begin{minted}{yaml}
datapoints:
  - temperature:
      - 1100 kelvin
      - uncertainty-type: absolute
        uncertainty: 10 kelvin
    ignition-delay:
      - 10 us
      - uncertainty-type: relative
        uncertainty: 0.1
    ...
\end{minted}

%====================================================================
\section{PyKED Architecture}
%
\pk{} is a Python package that currently provides the reference implementation
of the interface to \ck{} files. \pk{} reads \ck{} files, validates their
structure and content, and allows the user to interact with the datapoints
contained in the \ck{} file.

The basic user interface to the \ck{} file in \pk{} is through the
\python|ChemKED| class. The \python|ChemKED| class constructor takes the file
name of a \ck{} file or a Python dictionary containing the contents of a \ck{}
file as its argument. When the file or dictionary is loaded, it is validated to
have the correct format by Cerberus \autocite{cerberus}.

The fields of the \ck{} file are stored as instance attributes of the
\python|ChemKED| class. The following attributes are available with the
appropriate data:
%
\begin{itemize}
    \item \python|chemked_version|, \python|file_version|, \python|file_author|,
    \python|experiment_type|: Stores the values from the \ck{} file
    \item \python|reference|: Instance of a \python|namedtuple| containing all
    the information from the literature reference associated with the data
    \item \python|apparatus|: Instance of a \python|namedtuple| containing all
    the information about the apparatus used to perform the experiment
    \item \python|datapoints|: A Python list of \python|DataPoint| instances
\end{itemize}

The \python|DataPoint| class stores the information associated with a single
data point in the \ck{} file. Similar to the \python|ChemKED| class, the
information from the \ck{} file are stored as attributes of class instances,
including
%
\begin{itemize}
    \item \python|equivalence_ratio|: The value of the equivalence ratio, if
    present. For informational purposes only, no validation is done of the value
    \item \python|ignition_delay|, \python|temperature|, \python|pressure|,
    \python|pressure_rise|: The value of these data are stored as instances of
    the \python|Quantity| class from the Pint \autocite{Grecco2016} package,
    possibly with associated uncertainty
    \item \python|composition|: A list of dictionaries of the species and their
    respective amounts. The values are validated so that \yaml|mole-percent|,
    \yaml|mole-fraction|, or \yaml|mass-fraction| cannot be mixed for a single
    data point, and so that the sum of the values is approximately 1.0, or
    100.0 for \yaml|mole-percent|.
    \item \python|composition_type|: A string indicating the type of composition
    information for the data point---one of \python|'mole-percent'|,
    \python|'mole-fraction'|, or \python|'mass-fraction'|
    \item \python|volume_history|: If the \yaml|volume-history| of an RCM
    experiment is provided in the \ck{} file, it is stored in this attribute as
    a \python|namedtuple|, and the actual values are stored in NumPy arrays
    \autocite{vanderWalt:2011np}.
\end{itemize}

The \python|DataPoint| class has two instance methods defined, called
\python|get_cantera_mole_fraction| and \python|get_cantera_mass_fraction|. With
these methods, the composition of the reactant mixture can be output to a format
that can be used to set the composition of a Cantera \python|Solution|. Note
that the \python|composition| specification is not required to contain the
molecular weights of the components, so calling
\python|get_cantera_mass_fraction| when \yaml|mole-percent| or
\yaml|mole-fraction| has been used in the \ck{} file will raise a
\python|ValueError| (and vice versa for \python|get_cantera_mole_fraction|).

The \python|ChemKED| class has one instance method defined, called
\python|get_dataframe|. Using this method, the user can get an instance of a
Pandas~\autocite{pandas} \python|DataFrame| that contains the information in the
list of \python|DataPoint|s. The user can specify the columns provided in the
\python|DataFrame| by passing a list of column names to the
\python|output_columns| argument of the \python|get_dataframe| function. The
possible columns are not case-sensitive and are:

\noindent\begin{itemize*}
    \item \python|'Temperature'|
    \item \python|'Pressure'|
    \item \python|'Ignition Delay'|
    \item \python|'Composition'|
    \item \python|'Equivalence Ratio'|
    \item \python|'Reference'|
    \item \python|'Apparatus'|
    \item \python|'Experiment Type'|
    \item \python|'File Author'|
    \item \python|'File Version'|
    \item \python|'ChemKED Version'|
\end{itemize*}

In addition, specific fields from the Reference and Apparatus attributes can
be included by specifying the name after a colon. These options are:

\noindent\begin{itemize*}
    \item \python|'Reference:Volume'|
    \item \python|'Reference:Journal'|
    \item \python|'Reference:DOI'|
    \item \python|'Reference:Authors'|
    \item \python|'Reference:Detail'|
    \item \python|'Reference:Year'|
    \item \python|'Reference:Pages'|
    \item \python|'Apparatus:Kind'|
\end{itemize*}

% This weirdness is necessary to prevent the list from running over the margin
\noindent\begin{itemize*}
    \item \python|'Apparatus:Facility'|
    \item \python|'Apparatus:Institution'|
\end{itemize*}

Only the first author is printed when \python|Reference| or
\python|Reference:Authors| is selected because the whole author list may be
quite long.

\pk{} relies on well-established scientific Python software tools. These include
NumPy~\autocite{vanderWalt:2011np} for array manipulation,
Pint~\autocite{Grecco2016} for interpreting and converting between units,
\texttt{ruamel.yaml}~\autocite{ruamel_yaml} for parsing YAML files, Cerberus for
validating \ck{} files~\autocite{cerberus}, and pytest~\autocite{pytest:3.0.1}
for unit testing. Travis-CI~\autocite{Travis2016} provides continuous
integration testing.

\todo[inline]{Need to archive version of PyKED and cite}
\todo[inline, author=Bryan]{Should we do this even without officially releasing a version?}

\pk{} is available under the permissive, open-source BSD 3-clause license via a GitHub
repository: \url{https://github.com/pr-omethe-us/PyKED}. It can be installed using setuptools
by downloading the source code files and executing \texttt{python setup.py install}. More mature
versions of \pk{} will be distributed on \href{https://pypi.python.org/pypi}{PyPI}
(Python Package Index) and conda-forge.\todo{add URL}{}

%====================================================================
\section{Use example}
%
\todo[inline]{Bryan/Kyle to do}
\todo[inline]{Idea: CONV simulations using Cantera in a loop with conditions
from the Pandas output for butanol?}
\todo[inline]{Idea: VPRO simulations using Cantera from a \ck{} file for an RCM
datapoint}

%====================================================================
\section{Conclusions and future work}
%
\todo[inline]{both to do}

\printbibliography

\end{document}
