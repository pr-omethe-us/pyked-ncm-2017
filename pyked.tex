% !TEX option = -shell-escape
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% This work is licensed under the Creative Commons Attribution 4.0
% International License. To view a copy of this license, visit
% http://creativecommons.org/licenses/by/4.0/.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[12pt]{ussci}

\usepackage{todonotes}

\usepackage{xmpincl}
\includexmp{CC_Attribution_4.0_International}

\hypersetup{
    pdftitle={ChemKED: a human- and machine-readable data standard for chemical kinetics experiments},%
    pdfauthor={Bryan W. Weber},%
}

\newcommand\ck{ChemKED}
\newcommand\pk{PyKED}

\usepackage[inline]{enumitem}
\setlist{noitemsep}

\usepackage{microtype}
%======================================================================
\addbibresource{pyked.bib}
%======================================================================
\newcommand\papertopic{Reaction Kinetics}
%======================================================================

\title{ ChemKED: a human- and machine-readable data standard for chemical kinetics experiments }

\author[1*]{Bryan W. Weber}
\author[2]{Kyle E. Niemeyer}

\affil[1]{Department of Mechanical Engineering, University of Connecticut, Storrs, CT, USA}
\affil[2]{School of Mechanical, Industrial, and Manufacturing Engineering, Oregon State University, Corvallis, OR, USA}
\affil[*]{Corresponding author: \email{bryan.weber@uconn.edu}}

\begin{document}
\maketitle

%====================================================================
\begin{abstract} % not to exceed 200 words
Fundamental experimental measurements of quantities including ignition delay
times, laminar flame speeds, and species profiles serve important roles in
understanding fuel chemistry and validating chemical kinetic models. However,
despite both the importance and abundance of such information in the literature,
the community lacks a widely adopted standard format for this data. This impedes
both sharing and wide use by the community. In this paper, we will introduce a
new Chemical Kinetics Experimental Data format, ChemKED, and the related
Python-based package for creating and validating ChemKED-formatted files called
PyKED. We will also review past and related efforts, and motivate the need for a
new solution. ChemKED currently supports the representation of autoignition
delay time and laminar flame speed measurements. ChemKED-formatted files contain
all of the information needed to simulate experimental data points, including
uncertainty. ChemKED is based on the YAML data serialization language, and is
intended as a human- and machine-readable standard for easy creation and
automated use. Development of ChemKED and PyKED occurs openly on GitHub under
the BSD 3-clause license, and contributions from the community are welcome.
Plans for future development include support for experimental data from jet
stirred reactor, extinction, and speciation measurements.
\end{abstract}

% (Provide 2-4 keywords describing your research. Only abbreviations firmly
% established in the field may be used. These keywords will be used for
% sessioning/indexing purposes.)
\begin{keyword}
    chemical kinetics\sep data standard\sep software\sep database
\end{keyword}

%====================================================================
\section{Introduction}
%
Fundamental combustion experiments provide vital data for understanding fuel
chemistry and validating chemical kinetic models. Important measured quantities
include autoignition delay times, laminar flame speeds, and species profiles,
among others. However, despite both the importance and abundance of such
information in the literature, the combustion\slash chemical kinetics community
lacks an accepted, commonly used standard for recording and sharing data from
fundamental combustion experiments.\footnote{Interestingly, this contrasts the
situation for chemical kinetic models, where the CHEMKIN~\autocite{Kee:1996ck}
format dominates. Competing standards such as the
Cantera~\autocite{Cantera:2.3.0} CTI format or
FlameMaster~\autocite{FlameMaster:ref,FlameMaster:code} lag behind considerably,
although use of the former continually grows due to Cantera's open availability.
% Similarly, % with more space, discuss JANAF/NASA polynomial standard ?
}

Instead, such data is typically found in under-documented comma-separated value
(CSV) files and Excel spreadsheets, or contained in PDF tables rather than as
supplementary material associated with a paper. In the worst case, data is only
available in figures and must be digitized by the use of software such as
WebPlotDigitizer~\autocite{WebPlotDigitizer}. These practices limit the wide use
of the valuable, extensive experimental data available in the literature.
\textcite{Frenklach:2007bm} further explained the benefits of standardized,
widely available data for combustion. In brief, much of fundamental
combustion\slash chemical kinetics research drives towards the ultimate goal of
developing predictive kinetic models---and ultimately this depends on a
\emph{community} infrastructure for data and methods.

The combustion community has not yet widely adopted a standard format for
experimental data, but some researchers and groups have proposed solutions to
this problem. Most notably, Frenklach developed the PrIMe (\textbf{Pr}ocess
\textbf{I}nformatics \textbf{M}od\textbf{e}l) data
format~\autocite{Frenklach:2007bm,You:2011hy} and an associated online database,
the PrIMe Data Warehouse~\autocite{PrIMe}. PrIMe files encode fundamental
combustion experimental data, along with kinetic models and calculated
quantities, using the Extensible Markup Language (XML) standard.

PrIMe~\autocite{Frenklach:2007bm,You:2011hy} has a number of features that make
it a strong standardization format, but it suffers from several flaws that
prevent wide adoption. First, the PrIMe standard does not require or support all
the information needed to simulate an experiment, including a machine-readable
definition of ignition or a standard way to express detailed facility specific
effects important to properly simulating certain experiments. Second, the XML
format is intended to be a markup language rather than a data format, and
presents a barrier to creating and working with database files. Furthermore, the
focus on using internal identifiers for bibliographic references and
species\slash reactions, rather than standard identifiers (e.g., DOIs for
scholarly products and InCHI or SMILES for species), limits usability outside
the PrIMe ecosystem. Finally, the closed and opaque nature of the PrIMe standard
and associated Data Warehouse limit contributions and community development of
the PrIMe standard and compatible data files and tools.

More recently, Varga et al.~\autocite{Varga2015a,Varga2015b} developed the
ReSpecTh standard, which builds on the PrIMe format. ReSpecTh adds important
features that make files better standalone representations of experimental
data---i.e., more informative by themselves rather than in concert with a larger
system. For example, where PrIMe uses internal bibliographic references,
ReSpecTh adds a field for typical bibliographic data. The ReSpecTh standard also
provides machine-readable formats for specifying ignition experiments, including
a field for the definition of autoignition and the ability to specify
facility-specific effects. However, ReSpecTh experimental files are another
XML-based format, and as such, suffer from the same usability issues as PrIMe.
Moreover, the standard remains closed, requiring potential users to register
with the standard's authors to access the specification.

Nonetheless, the usefulness of databases of fundamental combustion experiments
has been shown to be quite useful. For instance, Olm and colleagues used their
ReSpecTh-based database to quantify the performance of literature
hydrogen~\autocite{Olm:2014gn} and syngas~\autocite{Olm:2015ch} kinetic models,
and more recently develop improved models for hydrogen\slash
syngas~\autocite{Varga:2016gj} and ethanol~\autocite{Olm:2016et}. In all four
cases, they converted numerous experimental datasets from the literature into
the ReSpecTh standard.

Despite the development of these standards, limited examples of open data
\emph{sharing} using the formats exist in the literature. To the best
of our knowledge, the largest such publicly available database is hosted by
the Clean Combustion Research Center at King Abdullah University of Science and
Technology (KAUST) and is known as CloudFlame
(\url{https://cloudflame.kaust.edu.sa}). Started in
2013~\autocite{Goteng:2013cf,Goteng:2014,ReynoChiasson:2015}, CloudFlame serves
as an openly accessible database for experimental data, available in a standard
CSV format, and also provides a cloud infrastructure for running simulations
based on stored models and data. While an admirable and useful effort,
CloudFlame, like ReSpecTh and PrIMe, is a closed system controlled by a single
institution rather than by the community at large.

Therefore, we believe there remains a need for an open, community-focused and
developed, combustion\slash chemical kinetics data format. In this work, we
present a new, open-source, human- and machine-readable data standard for
fundamental combustion experiments, \ck{}, and offer tools for easily working
with data encoded in this format. Niemeyer recently introduced an initial
version of the \ck{} format~\autocite{Niemeyer:2016wf}, and in this work we
further formalize and develop the standard. We also discuss a related Python
software tool for validating and working with \ck{} files: \pk{}. Our
motivations are similar those of the PrIMe and ReSpecTh teams: the \ck{} project
will enable easy sharing and use of fundamental combustion data, for the
(primary) purposes of developing and validating predictive chemical kinetic
models. However, we make usability a major design focus, and plan to share all
data and software openly to cultivate a community of user-contributors.

%====================================================================
\section{Overview of ChemKED format}\label{sec:overview-of-format}

This section will provide a brief introduction to the \ck{} database format.
This is not a complete listing of available fields and more complete examples of
\ck{} files can be found in the \pybox{tests} directory of the \pk{} package. In
addition, in Section~\ref{sec:usage-example}, we will provide examples of \ck{}
files. Note that in the following, text with gray background is a \yabox{yaml}
keyword or value, while text with a yellow background is \pybox{Python} code.

\ck{} files use the YAML data serialization format. This format offers the
advantages of being human readable, written in plain text, and having parsers in
most common programming languages, including Python, C++, Java, Perl, MATLAB,
and many others. The YAML syntax is quite simple. The basic file structure is
made of mappings, delimited by a colon. The key for the mapping is on the left
of the colon, and the value on the right can be a single value, a sequence of
values, a nested mapping, or some combination of these:
%
\begin{yamlbox}
key1: value  # Single-value mapping
key2:  # Sequence format
  - value
  - value
key3:  # Nested mapping
  key4: 0
key5:  # Sequence of mappings
  - key-s1: 0
    key-s2: value
  - key-s2: value
    key-s1: 0
\end{yamlbox}

The \yabox{value} can be a string, integer, or floating point number. The \ck{}
format is designed to include all of the information necessary to simulate a
given experiment and can be broken into two main sections. The first section
details all of the ``meta'' information about the experiment and the \ck{} file.
In this section, the common \yabox{author} mapping is used for any fields where
an author must be specified. The \yabox{author} mapping contains the following
fields:
%
\begin{itemize}
    \item \yabox{name} (required, string): The author's full name
    \item \yabox{ORCID} (optional, string): the author's ORCID number
\end{itemize}
%
More generally for the meta information, the required keys in this section
are:
%
\begin{itemize}
    \item \yabox{file-author} (required, \yabox{author}-type mapping): The
    author of the \ck{} file
    \item \yabox{file-version} (required, integer): The version of the \ck{}
    file
    \item \yabox{chemked-version} (required, string): The version of the \ck{}
    schema that this file conforms to
    \item \yabox{reference} (required, mapping): The reference information for
    the article associated with the data in the file. The fields in this
    mapping are:
    \begin{itemize}
        \item \yabox{authors} (required, sequence): A sequence of \yabox{author}
        mappings
        \item \yabox{journal} (required, string): The name of the publishing
        journal
        \item \yabox{year} (required, integer): The year of publication
    \end{itemize}
    \item \yabox{experiment-type} (required, string): Currently, only
    \yabox{ignition delay} is supported
    \item \yabox{apparatus} (required, string): The type of apparatus used to
    perform the experiment
\end{itemize}

The second section of the file encodes the experimental data. In the \ck{} file,
this is done in a sequence of mappings, with the following information required
in each element of the sequence:
%
\begin{itemize}
    \item \yabox{temperature} (required, sequence): The temperature of the
    experiment, with units
    \item \yabox{ignition-delay} (required, sequence): The ignition delay of the
    experiment, with units
    \item \yabox{pressure} (required, string): The pressure of the experiment,
    with units
    \item \yabox{composition} (required, sequence): The composition of the
    mixture in the experiment, a sequence of mappings with the following fields
    \begin{itemize}
        \item \yabox{species-name} (required, string): The name of the species
        \item \yabox{mole-fraction}, \yabox{mass-fraction}, \yabox{mole-percent}
        (required, float): The mole fraction or percent, or the mass fraction.
        Only one of the three is permitted in a given \yabox{composition}
        sequence.
        \item \yabox{InChI}, \yabox{SMILES}, \yabox{atomic-composition}, or
        \yabox{elemental-composition} (required, string or sequence): The InChI
        or SMILES representing the molecule, or its atomic or elemental
        composition (\yabox{atomic-composition} and
        \yabox{elemental-composition} are synonyms) as a sequence
    \end{itemize}
    \item \yabox{ignition-type} (required, mapping); The type of ignition
    measured in the experiments. The required fields are
    \begin{itemize}
        \item \yabox{type} (required, string): How the ignition delay was
        measured, one of \yabox{d/dt max} to indicate the ignition point is
        found at the maximum of the time derivative of the \yabox{target},
        \yabox{max} or \yabox{min} to indicate the ignition point is at the
        maximum or minimum of the \yabox{target}, or \yabox{1/2 max} to
        indicate the half-maximum point
        \item \yabox{target} (required, string): The target for the type of the
        ignition point, one of \yabox{temperature}, \yabox{pressure},
        \yabox{OH}, \yabox{OH*}, \yabox{CH}, or \yabox{CH*}
    \end{itemize}
\end{itemize}

The top-level key for the sequence is called \yabox{datapoints}. Each of the
quantities in an element must be specified with units. This should be done as a
single string associated with the first element of the sequence. The units of
the quantity are validated to ensure they have the appropriate dimensionality
for the quantity. In addition, each of the quantities in an element can
optionally be assigned an uncertainty. This uncertainty can be either absolute
or relative, and is specified as elements of the sequence of the associated key.
For example, the absolute uncertainty of the temperature and the relative
uncertainty of the ignition delay might be specified as follows:

\begin{yamlbox}
datapoints:
  - temperature:
      - 1100 kelvin
      - uncertainty-type: absolute
        uncertainty: 10 kelvin
    ignition-delay:
      - 10 us
      - uncertainty-type: relative
        uncertainty: 0.1
    ...
\end{yamlbox}

%====================================================================
\section{PyKED architecture}\label{sec:pyked-architecture}
%
\pk{} is a Python package that currently provides the reference implementation
of the interface to \ck{} files~\autocite{PyKED}. \pk{} reads \ck{} files, validates
their structure and content, and allows the user to interact with the data contained
in the \ck{} file.

The basic user interface to the \ck{} file in \pk{} is through the
\pybox{ChemKED} class. The \pybox{ChemKED} class constructor takes the file name
of a \ck{} file or a Python dictionary containing the contents of a \ck{} file
as its argument. When the file or dictionary is loaded, it is validated to have
the correct format by the Python package Cerberus \autocite{cerberus}. The
schema used for validation of the \ck{} files is available publicly in the
source code repository for
PyKED\footnote{\url{https://github.com/pr-omethe-us/PyKED/blob/master/pyked/chemked_schema.yaml}}.

The fields of the \ck{} file are stored as instance attributes of the
\pybox{ChemKED} class. The following attributes are available:
%
\begin{itemize}
    \item \pybox{chemked_version}, \pybox{file_version}, \pybox{file_author},
    \pybox{experiment_type}: Stores the values from the \ck{} file
    \item \pybox{reference}: Instance of a \pybox{namedtuple} containing all
    the information from the literature reference associated with the data
    \item \pybox{apparatus}: Instance of a \pybox{namedtuple} containing all
    the information about the apparatus used to perform the experiment
    \item \pybox{datapoints}: A Python list of \pybox{DataPoint} instances
\end{itemize}

The \pybox{DataPoint} class stores the information associated with a single data
point in the \ck{} file (i.e., a single element of the \yabox{datapoints}
sequence). Similar to the \pybox{ChemKED} class, information in the
\pybox{DataPoint} is stored as instance attributes:
%
\begin{itemize}
    \item \pybox{equivalence_ratio}: The value of the equivalence ratio, if
    present. For informational purposes only, no validation is done of the
    value.
    \item \pybox{ignition_delay}, \pybox{temperature}, \pybox{pressure},
    \pybox{pressure_rise}: The value of these data are stored as instances of
    the \pybox{Quantity} class from the Pint \autocite{Grecco2016} package,
    possibly with associated uncertainty
    \item \pybox{composition}: A list of dictionaries of the species and their
    respective amounts. The values are validated so that \yabox{mole-percent},
    \yabox{mole-fraction}, or \yabox{mass-fraction} cannot be mixed for a single
    data point, and so that the sum of the values is approximately 1.0, or
    100.0 for \yabox{mole-percent}.
    \item \pybox{composition_type}: A string indicating the type of composition
    information for the data point---one of \pybox{'mole-percent'},
    \pybox{'mole-fraction'}, or \pybox{'mass-fraction'}
    \item \pybox{volume_history}: If the \yabox{volume-history} of an RCM
    experiment is provided in the \ck{} file, it is stored in this attribute as
    a \pybox{namedtuple}, and the actual values are stored in NumPy arrays
    \autocite{vanderWalt:2011np}
    \item \pybox{compression_time}: If the \ck{} file encodes an RCM experiment,
    the length of the compression stroke may be included
    \item \pybox{ignition_type}: A dictionary specifying the method of the
    measurement of ignition delay
\end{itemize}

The \pybox{DataPoint} class has two instance methods defined, called
\pybox{get_cantera_mole_fraction()} and \pybox{get_cantera_mass_fraction()}.
With these methods, the composition of the reactant mixture can be output to a
format that can be used to set the composition of a Cantera~\pybox{Solution}.
Note that the \pybox{composition} specification does not contain the molecular
weights of the components, so conversion between mole fractions and mass
fractions is not possible.

The \pybox{ChemKED} class has one instance method defined:
\pybox{get_dataframe()}. Using this method, the user can get an instance of a
Pandas~\autocite{pandas} \pybox{DataFrame} that contains the information in the
list of \pybox{DataPoint}s. The user can specify the columns included in the
\pybox{DataFrame} by passing a list of column names to the
\pybox{output_columns} argument of the \pybox{get_dataframe()} method. The
possible columns are not case-sensitive and are:

\noindent\begin{itemize*}
    \item \pybox{'Temperature'}
    \item \pybox{'Pressure'}
    \item \pybox{'Ignition Delay'}
    \item \pybox{'Composition'}
    \item \pybox{'Equivalence Ratio'}
    \item \pybox{'Reference'}
    \item \pybox{'Apparatus'}
    \item \pybox{'Experiment Type'}
    \item \pybox{'File Author'}
    \item \pybox{'File Version'}
    \item \pybox{'ChemKED Version'}
\end{itemize*}

In addition, specific fields from the \pybox{Reference} and \pybox{Apparatus}
attributes can be included by specifying the name after a colon. These options
are:

\noindent\begin{itemize*}
    \item \pybox{'Reference:Volume'}
    \item \pybox{'Reference:Journal'}
    \item \pybox{'Reference:DOI'}
    \item \pybox{'Reference:Authors'}
    \item \pybox{'Reference:Detail'}
    \item \pybox{'Reference:Year'}
    \item \pybox{'Reference:Pages'}
    \item \pybox{'Apparatus:Kind'}
\end{itemize*}

% This weirdness is necessary to prevent the list from running over the margin
\noindent\begin{itemize*}
    \item \pybox{'Apparatus:Facility'}
    \item \pybox{'Apparatus:Institution'}
\end{itemize*}

Only the first author is printed when \pybox{Reference} or
\pybox{Reference:Authors} is selected because the whole author list may be
quite long.

\pk{}~\autocite{PyKED} relies on well-established scientific Python software tools.
These include NumPy~\autocite{vanderWalt:2011np} and Pandas~\autocite{pandas,McKinney2010}
for array manipulation, Pint~\autocite{Grecco2016} for interpreting and converting
between units, \texttt{ruamel.yaml}~\autocite{ruamel_yaml} for parsing YAML
files, Cerberus for validating \ck{} files~\autocite{cerberus}, and
pytest~\autocite{pytest:3.0.1} for unit testing. Travis-CI~\autocite{Travis2016}
provides continuous integration testing.

\pk{} is licensed under the permissive, open-source BSD 3-clause license. The
source code is publicly available on GitHub at
\url{https://github.com/pr-omethe-us/PyKED}~\autocite{PyKED}. Installation of stable versions
can be accomplished from a package repository, using either \pybox{pip} to install
from \href{https://pypi.python.org/pypi}{PyPI} (Python Package Index), or
\pybox{conda} to install from the
\href{https://anaconda.org/conda-forge}{\texttt{conda-forge}} channel. In
addition, \pk{} can be installed from the source code by running
\pybox|python setup.py install| or \pybox{pip install .} from the root
directory of the repository.

%====================================================================
\section{Usage example}\label{sec:usage-example}

The following usage examples provide a guide to the use of \pk{}. They are by no
means an exhaustive treatment, and are meant to demonstrate the basic
capabilities of the software.

\subsection{RCM modeling with varying reactor volume}\label{sec:rcm-modeling}

The \ck{} file that will be used in this example can be found in the
\pybox{tests} directory of the PyKED
repository\footnote{\url{https://github.com/pr-omethe-us/PyKED/blob/master/pyked/tests/testfile_rcm.yaml}}.
Examining that file, we find the first section specifies the information about
the \ck{} file itself:
%
\begin{yamlbox}
file-author:
  name: Kyle E Niemeyer
  ORCID: 0000-0003-4425-7097
file-version: (1, 0)
chemked-version: 0.0.1
\end{yamlbox}
%
Then, we find the information regarding the article in the literature from which
this data was taken. In this case, the data point is from the work of
\textcite{Mittal2006a}:
%
\begin{yamlbox}
reference:
  doi: 10.1002/kin.20180
  authors:
    - name: Gaurav Mittal
    - name: Chih-Jen Sung
      ORCID: 0000-0003-2046-8076
    - name: Richard A Yetter
  journal: International Journal of Chemical Kinetics
  year: 2006
  volume: 38
  pages: 516-529
  detail: Fig. 6, open circle
experiment-type: ignition delay
apparatus:
  kind: rapid compression machine
  institution: Case Western Reserve University
  facility: CWRU RCM
\end{yamlbox}
%
Finally, there is just a single datapoint in this file, which codes the ignition
delay for the experiment, the mixture composition, the initial temperature,
pressure, compression time, ignition type, and the volume history that specifies
how the volume of the reactor varies with time, simulating the compression
stroke and post-compression processes.
%
\begin{yamlbox}
datapoints:
  - temperature: 297.4 kelvin
    ignition-delay: 1.0 ms
    pressure: 958.0 torr
    composition:
      - species-name: H2
        InChI: 1S/H2/h1H
        mole-fraction: 0.12500
      - species-name: O2
        InChI: 1S/O2/c1-2
        mole-fraction: 0.06250
      - species-name: N2
        InChI: 1S/N2/c1-2
        mole-fraction: 0.18125
      - species-name: Ar
        InChI: 1S/Ar
        mole-fraction: 0.63125
    ignition-type:
      target: pressure
      type: d/dt max
    compression-time: 38.0 ms
    volume-history:
      time:
        units: s
        column: 0
      volume:
        units: cm3
        column: 1
      values:
        - [0.00E+000, 5.47669375000E+002]
        - [1.00E-003, 5.46608789894E+002]
        - [2.00E-003, 5.43427034574E+002]
        - [3.00E-003, 5.38124109043E+002]
        ...
\end{yamlbox}
%
The values for the \yabox{volume-history} are truncated to save space. A user
might like to load the information from this file to perform a simulation to
calculate the ignition delay using Cantera. All of the information required to
perform this simulation is present in the \ck{} file, with the exception of a
chemical kinetic mechanism for H$_2$/CO combustion.
%
\begin{pythonbox}
import cantera as ct
from pyked import ChemKED

# Load the ChemKED file and retrieve the first element of the
# datapoints list, which is an instance of the DataPoint class
ck = ChemKED('testfile_rcm.yaml')
dp = ck.datapoints[0]
\end{pythonbox}
%
The initial temperature, pressure, and mixture composition can be read from the
instance of the \pybox{DataPoint} class. \pk{} uses Pint \pybox{Quantities} to
store values with units, while Cantera expects a floating point value in SI
units as input. Therefore, we use the built-in capabilities of Pint to convert
the units from those specified in the \ck{} file to SI units:
%
\begin{pythonbox}
T_0 = dp.temperature.to('K').magnitude
P_0 = dp.pressure.to('Pa').magnitude
X_0 = dp.get_cantera_mole_fraction()

# Load the mechanism and set the initial state of the mixture
gas = ct.Solution('h2-co-mechanism.cti')
gas.TPX = T_0, P_0, X_0

# Create the reactor and the outside environment
reac = ct.IdealGasReactor(gas)
env = ct.Reservoir(ct.Solution('air.xml'))
\end{pythonbox}
%
To apply the effect of the volume trace to the \pybox{IdealGasReactor}, a
\pybox{Wall} is installed between the reactor and the environment and assigned
a velocity. Although we do not show the details here, a reference implementation
of a class that computes a wall velocity given the volume history of the reactor
is available in CanSen~\autocite{cansen}, in the
\pybox{cansen.profile.VolumeProfile} class.
%
\begin{pythonbox}
time = dp.volume_history.time
volume = dp.volume_history.volume
ct.Wall(reac, env, velocity=VolumeProfile(time=time, volume=volume))

netw = ct.ReactorNet([reac])

# Integrate for 50 ms
while netw.time < 0.05:
    netw.step()
\end{pythonbox}
%
Although not shown in this example, the user would typically store information
about the \pybox{IdealGasReactor} (e.g., temperature, pressure, mass fractions)
at each time step of the integration for post-processing.

\subsection{Shock tube modeling with constant volume}\label{sec:shock-tube}

The \ck{} file used in this example can be found in the \pybox{tests} directory of the \pk{}
repository\footnote{\url{https://github.com/pr-omethe-us/PyKED/blob/master/pyked/tests/testfile_st_p5.yaml}}.
The data in this file comes from Stranic et al.~\autocite{Stranic:2012}, describing
shock-tube ignition delays for \textit{tert}-butanol. We have omitted the file
meta information below for space; the format is largely similar to the example in Section~\ref{sec:rcm-modeling}.
%
In this \ck{} file, multiple data points are specified with some common
conditions, including a common mixture composition and common definition of
ignition delay. Therefore, a \yabox{common-properties} section is specified.
%
\begin{yamlbox}
common-properties:
  composition: &comp
    - species-name: t-butanol
      InChI: 1S/C4H10O/c1-4(2,3)5/h5H,1-3H3
      mole-fraction: 0.003333333
    - species-name: O2
      InChI:  1S/O2/c1-2
      mole-fraction: 0.04
    - species-name: Ar
      InChI:  1S/Ar
      mole-fraction: 0.956666667
  ignition-type:  &ign
    target: OH* concentration
    type: 1/2 max
\end{yamlbox}
%
This block uses the ability of YAML files to define an anchor with the
\yabox{&} symbol and refer to that section later with the \yabox{*} symbol, as
can be seen in the definition of the \yabox{datapoints} section:
%
\begin{yamlbox}
datapoints:
  - temperature: 1459 kelvin
    ignition-delay: 347 us
    pressure: 1.60 atm
    composition: *comp
    ignition-type: *ign
    equivalence-ratio: 0.5
  - temperature: 1389 kelvin
    ignition-delay: 756 us
    pressure: 1.67 atm
    composition: *comp
    ignition-type: *ign
    equivalence-ratio: 0.5
  - temperature: 1497 kelvin
    ignition-delay: 212 us
    pressure: 1.55 atm
    composition: *comp
    ignition-type: *ign
    equivalence-ratio: 0.5
  - temperature: 1562 kelvin
    ignition-delay: 105 us
    pressure: 1.50 atm
    composition: *comp
    ignition-type: *ign
    equivalence-ratio: 0.5
\end{yamlbox}

In this example, we would like to run constant volume simulations at each of the
pressure and temperature conditions in the \yabox{datapoints} list. Once again,
the \ck{} file specifies all the information required for the simulations except
for the chemical kinetic mechanism.
%
\begin{pythonbox}
import cantera as ct
from pyked import ChemKED

ck = ChemKED('Stranic2012-tbuoh.yaml')

gas = ct.Solution('tbuoh-mechanism.cti')

# Since the composition is specified by the common-properties,
# just take the composition of the first DataPoint
X_0 = ck.datapoints[0].get_cantera_mole_fraction()

# Loop through each of the DataPoints
for dp in ck.datapoints:
    T_0 = dp.temperature.to('K').magnitude
    P_0 = dp.pressure.to('Pa').magnitude
    gas.TPX = T_0, P_0, X_0
    reac = ct.IdealGasReactor(gas)
    netw = ct.ReactorNet([reac])
    # Define ignition delay as T_0 + 400 K
    while reac.T < T_0 + 400:
        netw.step()

    print('The ignition delay for T_0={}, P_0={} is: {} seconds'.format(
        T_0, P_0, netw.time
    ))
\end{pythonbox}
%
Note that the ignition delay in this example is defined as equal to $T_0 +
400\,\mathrm{K}$, a simplified definition used for this example. In general, the
user could post-process the concentration information from the simulation to
determine one-half the maximum OH* concentration to match the experimental
definition of ignition delay.
%====================================================================
\section{Conclusions and future work}

In this paper, we presented the \ck{} data format for describing measurements
taken from fundamental combustion experiments, recognizing that the community
has a need for an open and standardized data serialization format. \ck{} files
are formatted using the YAML language and are plain-text, human- and
machine-readable, and easy to construct.

We also presented a Python-based tool, \pk{}, for validating and working
with \ck{} files. \pk{} provides the reference implementation of the validator
for \ck{} files and utilizes several common packages from Python's scientific
computing community. \pk{} and \ck{} currently support ignition delay
measurements from rapid compression machines and shock tubes, including
facility-specific effects from each type of experiment.

\ck{} and \pk{} are currently under active development, and contributions from
the community are welcomed. All development occurs under the BSD 3-clause
license and the code is housed on GitHub at
\url{https://github.com/pr-omethe-us/PyKED}. Future directions for development
are outlined in the public
roadmap\footnote{\url{https://github.com/pr-omethe-us/PyKED/wiki/Roadmap}}. The
highest priority issues are currently adding support for other types of
fundamental experiments, including flame speed, speciation, and flame extinction
measurements.

\printbibliography

\end{document}
